---
layout: default
---

{% assign lessons = (site.lessons | where: 'book', page.book) %}
  
  <section class="toc">
    <ul class="lessons">
      {% for lesson in lessons %}
      {% if lesson.published %}
        <li>
          <a href="{{ page.url | prepend: site.baseurl }}#lesson-{{ page.book }}-{{ lesson.lesson }}">
            {% include lesson-title.html lesson=lesson %}
          </a>
        </li>
      {% endif %}
      {% endfor %}
    </ul>
  </section>
  
  {% for lesson in lessons %}
  {% if lesson.published %}
    {% assign habits = (site.data.habits | where: 'name', lesson.title) %}
    {% unless habits == empty %}
      {% assign habit = habits[0] %}
      {% assign habitclass = 'habit-lesson' %}
    {% else %}
      {% assign habit = false %}
      {% assign habitclass = '' %}
    {% endunless %}
    
    <section class="lesson {{habitclass}}" id="lesson-{{ page.book }}-{{ lesson.lesson }}">
      {% if habit %}
        {% include habit-header.html habit=habit %}
      {% endif %}
      {% capture emptytag %}{% raw %}{%  %}{% endraw %}{% endcapture %}
      {{ lesson.content | remove_first: 'raw' | remove: 'endraw' | remove: emptytag }}
    </section>
  {% endif %}
  {% endfor %}
